# -*- coding: utf-8 -*-
"""國立羅東高級工業職業學校_218224_游季甫.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1byuGNQbEADtnQ7vYiuD7qHt6dl1KLali
"""

import seaborn as sns
import warnings
warnings.filterwarnings("ignore", category=FutureWarning)
import pandas as pd
import matplotlib.pyplot as plt

# 讀取 CSV 檔案
df = pd.read_csv('觀光遊憩據點按縣市及遊憩據點交叉分析.csv')

# 定義縣市名稱映射
county_name_mapping = {
    '金門縣': 'Kinmen',
    '連江縣': "Lianjiang",
    '澎湖縣': 'Penghu',
    '臺東縣': 'Taitung',

}

# 將縣市中文名稱替換為英文名稱
df['縣市'] = df['縣市'].map(county_name_mapping)

# 選擇月份欄位並計算總和
月份欄位 = df.columns[4:-1]  # 從第五欄到倒數第二欄

# 將月份欄位轉換為數值類型，處理日期格式
for 欄位 in 月份欄位:
    # 嘗試提取月份並轉換為數值
    df[欄位] = pd.to_numeric(df[欄位].str.extract(r'(\d+)', expand=False), errors='coerce')

# 按照縣市分組並計算總和、中位數和最大值
df['總和'] = df[月份欄位].sum(axis=1)
縣市總和 = df.groupby('縣市')['總和'].agg(['median', 'max']).reset_index()  # 直接計算中位數和最大值

# 使用 seaborn 生成箱型圖
plt.figure(figsize=(12, 6))
# 使用英文縣市名稱繪製箱型圖，並使用 showfliers=False 隱藏離群值
sns.boxplot(x='縣市', y='總和', data=df, order=list(county_name_mapping.values()), showfliers=False)
# 定義 stats 變數，將縣市作為索引
stats = 縣市總和.set_index('縣市')
# 標註最大值、中位數，使用英文縣市名稱
#箱形圖算中位數、最大數的語法
for i, county in enumerate(stats.index):
    plt.text(i, stats['median'][county], f'Median: {int(stats["median"][county])}',
             ha='center', va='bottom', fontsize=10, color='black')
    plt.text(i, stats['max'][county], f'Max: {int(stats["max"][county])}',
             ha='center', va='bottom', fontsize=10, color='blue')
# 設定圖表樣式，使用英文標籤
plt.xlabel('County', fontsize=14)
plt.ylabel('Tourists', fontsize=14)
plt.grid(axis='y')
plt.xticks(rotation=45)  # 旋轉 x 軸標籤
plt.tight_layout()

# 儲存圖表
plt.savefig('001.jpg')
plt.clf()
plt.close()